[{"content":"前言 最近改用nixos，当然希望vps也能安装相同的系统。virmach家可通过netboot,xyz安装，比较方便。但手上有一台vps,商家只支持debian和centos，只能自己想办法安装。\n内存安装最小化系统 此处使用的是menhera.sh方案，在使用前记得备份好网络等重要信息。\n1 2 3 wget https://raw.githubusercontent.com/Jamesits/menhera.sh/master/menhera.sh chmod +x menhera.sh ./menhera.sh 根据提示即可安装成功，然后重启进入新系统。\n准备环境 查看磁盘挂载情况，旧系统根目录挂载在/mnt/oldroot,删除磁盘原有文件。同时防止内存不足，将/nix挂载到硬盘，如果有交换区，可以开启。\n1 2 3 4 5 rm -rf /mnt/oldroot/* mkdir /mnt/oldroot/xxx mkdir /nix mount -o bind /mnt/oldroot/xxx /nix swapon /dev/vda2 安装必要的工具。\n1 2 apt update apt install -y wget curl xz-utils sudo git nano 创建相关组和用户\n1 2 groupadd -g 30000 nixbld useradd -m -u 30000 -g nixbld -G nixbld -s /bin/bash nixbld nixbld用户添加sudo权限，并添加nixUnstable配置，同时变更/nix所属\n1 2 3 4 echo \u0026#34;nixbld ALL=(ALL) NOPASSWD: ALL\u0026#34; \u0026gt;\u0026gt; /etc/sudoers mkdir -p /etc/nix echo \u0026#34;experimental-features = nix-command flakes\u0026#34; \u0026gt; /etc/nix/nix.conf chown -R nixbld /nix 切换至nixbld用户\n1 2 su nixbld cd ~ 安装nix工具和新系统 此处使用nix-unstable-installer方案。\n官方稳定版已经支持nix flake。\n1 2 curl -L https://nixos.org/nix/install | sh . $HOME/.nix-profile/etc/profile.d/nix.sh 更新channel\n1 nix-channel --update 安装nixos-install-tools\n1 nix-env -f \u0026#39;\u0026lt;nixpkgs\u0026gt;\u0026#39; -iA nixos-install-tools 创建配置文件，配置文件默认安装在/mnt/etc/nixos（可选,注意：此处UUID错误，需要修改）\n1 sudo `which nixos-generate-config` --root /mnt/oldroot 因为我已经提前准备好配置，所以不需要上一步，或者仅需要上一步产生的hardware-configuration.nix，修改好配置后进行安装。\n1 2 3 4 git clone git@github.com:ZenQy/nixos.git cd nixos cp /mnt/oldroot/etc/nixos/hardware-configuration.nix host/cc/hardware.nix sudo PATH=\u0026#34;$PATH\u0026#34; `which nixos-install` --root /mnt/oldroot --flake .#cc 如果安装时报错，无需担心，重新切换到nixbld用户，再次安装即可成功。 重启即可进入新系统，重启前可以考虑把配置文件转移到新系统中,重启后记得删除/xxx文件夹。\n1 2 cd ../ sudo mv nixos /mnt/root/ 常见问题 ailed to create file via template ‘/tmp/tmp.XXXXXXXXXX’: No such file or directory 答：手动创建/tmp文件夹\nchroot: failed to run command ‘systemd-tmpfiles’: No such file or directory 答：没找到解决方案，有时不影响，可以成功进入系统，有时却不可以\nnixos-install 过程中直接killed 答：系统内存不足，不用官方ubuntu系统，改用debian、arch或nixos就能成功\n","date":"2021-09-16T18:02:28+08:00","permalink":"https://blog.940940.xyz/p/%E7%8E%B0%E6%9C%89%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85nixos/","title":"现有系统安装nixos"},{"content":"前言 之前写过现有系统安装ArchLinux，针对的是x86架构，后来甲骨文推出了arm架构的vps,虽然也重新安装了ArchLinuxARM，但未做记录。昨天估计首尔区放水，成功开通。趁这次重装，记录安装过程。因大体与x86安装过程类似，仅简要记录关键步骤。\n前期准备 与前文一致，不作赘述。\n创建chroot环境 安装debootstrap，创建bootstrap。 1 2 3 4 apt update apt install debootstrap mkdir /tmp/stable-chroot debootstrap stable /tmp/stable-chroot http://deb.debian.org/debian/ chroot 1 2 3 4 5 6 7 cd /tmp/stable-chroot cp /etc/resolv.conf etc mount -t proc /proc proc mount --make-rslave --rbind /sys sys mount --make-rslave --rbind /dev dev mount --make-rslave --rbind /run run chroot ./ /bin/bash 使用chroot环境安装系统 挂载设备、删除旧系统部分，与前文一致，不作赘述。\n安装基础系统 因debootstrap没有预装wget,需先安装，然后下载ArchLinuxARM-aarch64-latest.tar.gz,并解压。\n1 2 3 4 apt update apt install wget wget http://os.archlinuxarm.org/os/ArchLinuxARM-aarch64-latest.tar.gz tar -xpf ArchLinuxARM-aarch64-latest.tar.gz -C /mnt chroot，进入目标系统 1 2 3 4 5 6 cd /mnt mount -t proc /proc proc mount --make-rslave --rbind /sys sys mount --make-rslave --rbind /dev dev mount --make-rslave --rbind /run run chroot /mnt /bin/bash 初始化 pacman keyring 1 2 pacman-key --init pacman-key --populate archlinuxarm 完善系统 以下部分与前文一致，不作赘述。\n时区，此处选择东八区 本地化 SSH 设置root密码 以下部分与前文有所改动。\n网络设置 无需创建systemd-networkd配置文件，其他不变。\n设置boot /boot/loader/entries/arch.conf内容如下，其他不变。\n1 2 3 4 title Arch Linux linux /Image initrd /initramfs-linux.img options root=\u0026#34;LABEL=cloudimg-rootfs\u0026#34; rw 进入新系统 连续输入两次 exit 退出到原系统， 然后 reboot 重启，等待几分钟后，重新连接ssh,进入则表明重装成功。\n","date":"2021-08-06T18:29:32+08:00","permalink":"https://blog.940940.xyz/p/%E7%8E%B0%E6%9C%89%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85archlinuxarm%E7%AF%87/","title":"现有系统安装ArchLinux（ARM篇）"},{"content":"前言 一般只适用于 Debian、Ubuntu、Contos、Redhat等主流服务器发行版\nBBR 手动开启，无需脚本 1 2 3 4 echo \u0026#34;net.core.default_qdisc=fq\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.ipv4.tcp_congestion_control=bbr\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p lsmod | grep bbr N合一脚本 1 2 3 wget -N --no-check-certificate https://raw.githubusercontent.com/ylx2016/Linux-NetSpeed/master/tcp.sh chmod +x tcp.sh ./tcp.sh v2ray 1 2 3 wget -N --no-check-certificate -q -O v2ray.sh https://raw.githubusercontent.com/wulabing/V2Ray_ws-tls_bash_onekey/master/install.sh chmod +x v2ray.sh ./v2ray.sh 探针 ServerStatus-Hotaru 1 2 3 4 wget https://raw.githubusercontent.com/CokeMine/ServerStatus-Hotaru/master/status.sh chmod +x status.sh ./status.sh s # 服务端 ./status.sh c # 客户端 哪吒面板 1 2 3 curl -L https://raw.githubusercontent.com/naiba/nezha/master/script/install.sh -o nezha.sh chmod +x nezha.sh ./nezha.sh 测试脚本 Bench.sh 1 wget -qO- bench.sh | bash wget -qO- bench.sh | bash 1 wget -qO- --no-check-certificate https://raw.githubusercontent.com/oooldking/script/master/superbench.sh | bash Yet-Another-Bench-Script 1 curl -sL yabs.sh | bash 合集 1 2 3 wget -N --no-check-certificate https://raw.githubusercontent.com/veip007/hj/master/hj.sh chmod +x hj.sh ./hj.sh DD脚本 1 bash \u0026lt;(wget --no-check-certificate -qO- \u0026#39;https://raw.githubusercontent.com/MoeClub/Note/master/InstallNET.sh\u0026#39;) -d 11 -v 64 -p \u0026#34;自定义root密码\u0026#34; -port \u0026#34;自定义ssh端口\u0026#34; 参数 例子 说明 -d 9,10,11 Debian -u 18.04,20.04 Ubuntu -c 6.9 CentOS -v 32,64 arch -p QWERqwer password,默认MoeClub.org -port 1234 ssh port,默认22 \u0026ndash;mirror http://mirrors.ustc.edu.cn/debian mirror -dd http://d.nat.ee/win/lite/wes7-x86-cn-lite/wes7-x86-cn-lite.vhd.gz win uri ","date":"2020-12-05T11:31:05+08:00","permalink":"https://blog.940940.xyz/p/vps%E4%B8%80%E9%94%AE%E8%84%9A%E6%9C%AC%E6%94%B6%E9%9B%86/","title":"Vps一键脚本收集"},{"content":"前言 本人对比较喜欢ArchLinux，使用的vps基本对会使用vps2arch脚本，将系统变更为ArchLinux。今天从OracleCloud薅羊毛，得到永久免费vps，自然想安装ArchLinux，但OracleCloud使用的是UEFI启动方式，vps2arch 脚本不再适用，不得不手动安装，特此记录。\n实际上，与在已有系统安装ArchLinux类似，区别仅仅是安装位置是原系统所在分区，安装前需删除原系统数据。\n前期准备 查询设备UUID信息 blkid\n1 2 3 /dev/sda1: LABEL=\u0026#34;cloudimg-rootfs\u0026#34; UUID=\u0026#34;206a406e-5432-46e5-82b5-66bed63992ba\u0026#34; BLOCK_SIZE=\u0026#34;4096\u0026#34; TYPE=\u0026#34;ext4\u0026#34; PARTUUID=\u0026#34;0b4f381f-b07c-435c-8947-0d6e545b4518\u0026#34; /dev/sda14: PARTUUID=\u0026#34;ea7c39ab-f4de-475b-b996-0617a04d4705\u0026#34; /dev/sda15: LABEL_FATBOOT=\u0026#34;UEFI\u0026#34; LABEL=\u0026#34;UEFI\u0026#34; UUID=\u0026#34;0100-A4A7\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;1307abb3-75dd-4990-82f8-48bb2d69c5da\u0026#34; 查询设备分区信息 lsblk\n1 2 3 4 5 NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 46.6G 0 disk |-sda1 8:1 0 46.5G 0 part / |-sda14 8:14 0 4M 0 part `-sda15 8:15 0 106M 0 part /boot 创建chroot环境 下载并解压bootstrap（因本人选择的大阪机房，所以选择日本的源） 1 2 3 cd /tmp wget http://mirrors.cat.net/archlinux/iso/latest/archlinux-bootstrap-2020.12.01-x86_64.tar.gz tar xzf archlinux-bootstrap-*-x86_64.tar.gz 选择源 1 echo \u0026#39;Server = http://mirrors.cat.net/archlinux/$repo/os/$arch\u0026#39; \u0026gt; root.x86_64/etc/pacman.d/mirrorlist chroot (这一步操作时会报错，但实际已成功chroot) 1 /tmp/root.x86_64/bin/arch-chroot /tmp/root.x86_64/ 使用chroot环境安装系统 初始化 pacman keyring 1 2 pacman-key --init pacman-key --populate archlinux 挂载设备（最好和原系统保持一致） 1 2 mount /dev/sda1 /mnt mount /dev/sda15 /mnt/boot 删除旧系统 因为是在原系统上安装AchLinux，所以要删除原系统中的文件，但全删除后系统异常，无法继续安装，所以需保留必要文件。以下目录需保留，其余文件可全部删除。\n目录/文件 说明 boot 保留目录即可，内部文件可全部删除 tmp bootstrap正在使用，不可删除 dev、proc、run、sys etc/{resolv.conf,fstab} 安装基础系统 1 pacstrap /mnt base base-devel linux openssh nano neofetch chroot，进入目标系统 1 arch-chroot /mnt 完善系统 时区，此处选择东八区 1 2 ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime hwclock --systohc 本地化 1 2 3 echo \u0026#39;en_US.UTF-8 UTF-8\u0026#39; \u0026gt; /etc/locale.gen locale-gen echo \u0026#39;LANG=en_US.UTF-8\u0026#39; \u0026gt; /etc/locale.conf 网络设置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 echo \u0026#39;oraclecloud\u0026#39; \u0026gt; /etc/hostname cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/hosts 127.0.0.1 localhost ::1 localhost 127.0.1.1 oraclecloud.localdomain oraclecloud EOF cat \u0026lt;\u0026lt; EOF \u0026gt; /etc/systemd/network/20-wired.network [Match] Name=ens3 [Network] DHCP=ipv4 EOF systemctl enable systemd-networkd SSH 在 /etc/ssh/sshd_config 变更以下设置\n1 2 3 PermitRootLogin yes ClientAliveInterval 60 ClientAliveCountMax 360 创建 /root/.ssh/authorized_keys 文件，添加个人的 id_rsa.pub ，并设置文件权限为0600。\n自启动sshd\n1 systemctl enable sshd 设置boot 本人喜欢 systemd-boot ，所以使用它作为启动引导。\n1 bootctl install 配置 loader.conf 和 arch.conf 文件\n1 2 3 4 5 6 7 8 9 10 11 12 cat \u0026lt;\u0026lt; EOF \u0026gt; /boot/loader/loader.conf timeout 2 default arch console-mode auto EOF cat \u0026lt;\u0026lt; EOF \u0026gt; /boot/loader/entries/arch.conf title Arch Linux linux /vmlinuz-linux initrd /initramfs-linux.img options root=\u0026#34;LABEL=cloudimg-rootfs\u0026#34; rw EOF 设置root密码 1 passwd 进入新系统 连续输入两次 exit 退出到原系统， 然后 reboot 重启，等待几分钟后，重新连接ssh,进入则表明重装成功。\n","date":"2020-12-04T19:29:32+08:00","permalink":"https://blog.940940.xyz/p/%E7%8E%B0%E6%9C%89%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85archlinux/","title":"现有系统安装ArchLinux"},{"content":"商店 名称 链接 版本 备注 移动惠生活 点击下载 最新 应用宝 国网商旅云 点击下载 最新 应用宝 账号本子 点击下载 最新 酷安 轻启动 点击下载 最新 酷安 幕布 点击下载 最新 酷安 microsoft todo 点击下载 最新 小米 github 名称 链接 版本 clash for android 点击下载 最新 AnkiDroid 点击下载 最新 aegis 点击下载 最新 贴吧lite 点击下载 最新 Magisk 点击下载 最新 网盘 名称 链接 版本 备注 mxplayer 点击下载 v1.29.6 破解版 其他 名称 链接 版本 备注 Z直播 点击下载 最新 官方 和包支付 点击下载 最新 官方 作业信息 点击下载 最新 官方 juicessh 点击下载 最新 官方 telegram 点击下载 最新 官方 ","date":"2020-10-24T11:37:29+08:00","permalink":"https://blog.940940.xyz/p/my-android-app-list/","title":"My Android App List"},{"content":"设备简介 key value 名称 魔百盒 型号 CM201-2 芯片 MV300 代工 朝歌 闪存 nand 进入Recovery 机顶盒完全断电，通电后立即不停交替按遥控器菜单键和音量减键，即可进入Recovery模式。\n条件苛刻，可能需尝试多次才能成功。\n连接设备 有以下2种方式：\nADB方式 机顶盒连接网络，同一局域网中，使用adb命令连接设备。\nadb connect \u0026lt;设备ip\u0026gt;\n该方法未在原版系统尝试\nSerial方式 使用TTL转USB连接电脑和机顶盒，TTL转USB上的TXD、RXD、GND分别对应机顶盒RX、TX、GND（主板右下方4个孔中右侧3个），速率设置为115200。在Windows系统可使用Putty工具连接。\n刷机过程 准备刷机文件，例如魔百盒CM201-2朝歌代工MV300芯片-蓝牙语音版,密码：0000 刷入底包（不是所有固件都需要底包），将底包放入U盘中，路径为/upgrade/update.zip，机顶盒开机会自动识别并刷入底包。我实际操作并未识别，使用遥控器进入Recovery模式手动刷入的。 使用ADB方式连接机顶盒 刷入固件。将固件（emmc、recovery.img、update.zip）放入U盘根目录中，使用以下命令刷入固件： 进入shell\nadb shell\n识别闪存类型，输出有ubifs字样说明是nand闪存，输出有ext4字样的是emmc闪存\nmount | grep system\nnand闪存机顶盒刷机\ncd mnt/sda/sda1\ndd if=recovery.img of=/dev/block/mtdblock2\ndd if=recovery.img of=/dev/block/mtdblock3\ndd if=emmc of=/dev/block/mtdblock4\nreboot\n重启后进入Recovery模式，选择apply update from external storage选项，选择update.zip进行更新，运行完毕机顶盒会自动重启。\n结束语 魔百盒作为移动自家的机顶盒，限制颇多，使用过程中总有被束缚的感觉，刷机后去除限制，能访问Samba，直接观看局域网内的影视资源还是很不错的。\n","date":"2020-04-11T19:37:29+08:00","permalink":"https://blog.940940.xyz/p/%E9%AD%94%E7%99%BE%E7%9B%92cm201-2%E5%88%B7%E6%9C%BA/","title":"魔百盒CM201-2刷机"},{"content":"身体方面 增加运动，体重下降5kg，腹部赘肉明显减少 人文方面 泛读10本文学相关书籍，2本名著 尽量背诵中学时期古诗词，传送门 工作方面 报考一级注册计量师 熟悉计量版全部工作内容 争取竞聘专责 多阅读政府及公司正式行文，提升撰写报告水平 兴趣方面 减少在游戏上消耗的时间 学习英语，水平提升至六级 认真学习《Go语言圣经》 学习vue，并能写简单前端 开发一个简单项目（目前想法是签到工具） ","date":"2020-01-01T19:37:29+08:00","permalink":"https://blog.940940.xyz/p/2020%E5%B9%B4%E8%AE%A1%E5%88%92/","title":"2020年计划"},{"content":"电脑主要配置 硬件 型号 备注 CPU E3-1231 v3 3.4G Hz 主板 华硕 B85M-G plus 显卡 Nvidia GTX 960 微星 声卡 realtek ALC887 网卡 realtek RTL8168/8111/8112 安装过程 下载镜像 受N卡驱动限制，最高只能安装10.13.6版本的Mac OS镜像。我是在此处下载的。\n制作U盘启动 windows系统下可以使用transMac工具制作\n配置clover 这应该是安装黑苹果最困难年的地方吧。我在网上下载了几个硬件配置与我相近的网友的配置文件，根据自己的硬件情况进行微调，这是我目前使用的配置文件。\nU盘安装 安装本身比较简单，按提示操作即可。但实际操作过程中会遇到报错：\n不能验证这个“安装 OS X EI Capitan”应用程序副本，它在下载过程中可能一遭破坏和篡改。\n这是苹果公司更换证书导致的，只需要将当前系统时间更改为2015.12.20-2016.2.14之间即可。\n安装N卡驱动 u盘安装后进入苹果系统，这时除了显卡外其他设备应该都正常驱动，在官方下载最新N卡驱动，直接安装会提示与苹果系统版本不匹配，无法安装。\ngithub上有相应解决方法。使用本地安装方式安装即可。\n至此，黑苹果基本能正常使用了。后面就是长期使用过程中的微调。我用了半天，各种不习惯，基本不再登录。\n","date":"2019-12-22T21:28:03+08:00","permalink":"https://blog.940940.xyz/p/%E9%BB%91%E8%8B%B9%E6%9E%9C%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95/","title":"黑苹果安装记录"}]